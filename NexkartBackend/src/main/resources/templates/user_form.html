<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>[[${pageTitle}]]</title>
	<script th:src="@{/nav.js}" type="text/javascript"></script>
	<link rel="icon" type="image/x-icon" th:href="@{/favicon-32x32.png}"/>
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<link th:href="@{https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css}" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link rel="apple-touch-icon" th:href="@{/apple-touch-icon.png}" sizes="180x180">
	<link rel="icon" type="image/x-icon" th:href="@{/nexfav.ico}">
	<link rel="manifest" th:href="@{/site.webmanifest}">
	<link rel="mask-icon" th:href="@{/safari-pinned-tab.svg}" color="#5bbad5">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">

	<link rel="stylesheet" type="text/css" th:href="@{/animation.css}">
	
	<style>
		@media only screen and (max-width: 768px) {
			.logo {
				height: 1.8em;
			}
		}

		#form {
			box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.575);
		}
		

	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		
		
</head>

<body class="">
	
	<form  th:action="@{/logout}" method="post" th:hidden="true"
	name="logoutForm" >
		<input type="submit">
	</form>

	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<!-- content part from here  -->
	<div>
		<h2 class="m-5  pl-5 bold h-6  text-2xl">[[${pageTitle}]]</h2>

	</div>
	
	<style>
		
		@media (max-width: 768px) { 
			.main{
				margin:25px;
			}
			
		}
	</style>
	
	
	<div class="main">
	<form th:action="@{/users/save}" enctype="multipart/form-data"  onsubmit="return checkEmailUnique(this);" th:object="${user}" method="post"
		id="form" class="max-w-md mx-auto mt-8 z-5  shadow-md rounded px-8 pt-6 pb-8 mb-4 mb-16">
		<input type="hidden" th:field = "*{id}">
		<!-- Email input -->
		<div class="mb-4">
			<label class="block text-gray-700 text-sm font-bold mb-2" for="email">
				Email
			</label>
			<input
				class="shadow appearance-none focus:bg-blue-50 border-b-2 border-gray-400 focus:border-blue-500 active:border-blue-500 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				id="email" th:field="*{email}" required minlength="8" maxlength="128" type="email"
				placeholder="Enter your email">
		</div>
		<!-- First Name input -->
		<div class="mb-4">
			<label class="block text-gray-700 text-sm font-bold mb-2" for="first-name">
				First Name
			</label>
			<input
				class="shadow appearance-none focus:bg-blue-50 border-b-2 border-gray-400 focus:border-blue-500 active:border-blue-500 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				id="first-name" th:field="*{firstName}" required minlength="4" maxlength="50" type="text"
				placeholder="Enter your first name">
		</div>
		<!-- Last Name input -->
		<div class="mb-4">
			<label class="block text-gray-700 text-sm font-bold mb-2" for="last-name">
				Last Name
			</label>
			<input
				class="shadow appearance-none focus:bg-blue-50 border-b-2 border-gray-400 focus:border-blue-500 active:border-blue-500 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				id="last-name" th:field="*{lastName}" required minlength="4" maxlength="50" type="text"
				placeholder="Enter your last name">
		</div>
		<!-- Password input -->
		<div class="mb-4">
			<label class="block text-gray-700 text-sm font-bold mb-2" for="password">
				Password
			</label>
			<input
				class="shadow appearance-none focus:bg-blue-50 border-b-2 border-gray-400 focus:border-blue-500 active:border-blue-500 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				id="password" th:if="${user.id == null}" th:field="*{password}" required minlength="4" maxlength="20" type="password"
				placeholder="Enter your password">
				
				<input
				class="shadow appearance-none focus:bg-blue-50 border-b-2 border-gray-400 focus:border-blue-500 active:border-blue-500 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
				id="password" th:if="${user.id != null}" th:field="*{password}"  minlength="4" maxlength="20" type="password"
				placeholder="Enter your password">
		</div>
		<!-- Roles checkboxes  -->
		<div class="mb-4">
			<label class="block text-gray-700 text-sm font-bold mb-2">
				Roles
			</label>

			<div class="grid grid-cols-2 md:grid-cols-2 gap-3">
				<th:block th:each="role : ${listRoles}">
					<label class="flex items-center">
						<input type="checkbox" th:field="*{roles}" th:value="${role.id}"
							class="form-checkbox h-3 w-3 text-indigo-600">
						<span class="ml-2 text-sm text-gray-800" th:text="${role.name}"></span>
					</label>
				</th:block>
			</div>
		</div>

		<!-- Enabled checkbox -->
		<div class="mb-4">
			<label for="enabled" class="text-gray-700 text-sm  font-bold mb-2 pr-4">Enabled</label>
			<input type="checkbox" th:field="*{enabled}" id="enabled" name="enabled" class="mr-2 	h-3 w-3 ">
		</div>


<!--		image input-->
		<div class="flex flex-col items-center">
			<input type="hidden" th:field="*{photos}">
			<input type="file" id="fileImage" name="fileImage" accept="image/jpeg,image/png,image/bmp"
				   class="block w-full text-sm text-gray-700 border border-gray-300 rounded-lg cursor-pointer bg-white py-2 px-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
			<img id="thumbnail" alt="Photo Preview" src="/default.png"
				 class="mt-4 mb-5 w-40 h-40 object-cover border border-gray-300 rounded-lg shadow-md ">
		</div>

		<!-- Submit button -->
		<div class="flex items-center justify-evenly">
			<button
				class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-2 px-5 rounded focus:outline-none focus:shadow-outline"
				type="submit">
				Submit
			</button>
			<button
				class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
				type="submit" id="buttonCancel">
				Cancel
			</button>
		</div>

	</form>
	
	</div>
	
	
	
	
	<script> 
		$(document).ready(function() {
					 $("#logoutLink").on("click" , function(e) {
						e.preventDefault();
						document.logoutForm.submit();
					 });
					 });
				
				document.addEventListener('DOMContentLoaded', function () {
				    const button = document.querySelector('li > button');
				    const dropdown = button.nextElementSibling;

				    button.addEventListener('click', function () {
				        dropdown.classList.toggle('hidden');
				    });

				    document.addEventListener('click', function (event) {
				        if (!button.contains(event.target)) {
				            dropdown.classList.add('hidden');
				        }
				    });
				});

			</script>

<!--	<script  th:src="@{/js/common_form.js}" ></script>-->

	<script type="text/javascript">

		$(document).ready(function () {

			$("#fileImage").on("change", function () {
				fileSize = this.files[0].size;

				if(fileSize > 1048576) {
					this.setCustomValidity('File size must be less than 1MB! ');
				}
				else{
					this.setCustomValidity('');
					showImageThumbnail(this);
				}
			});
		});

		function showImageThumbnail(input) {
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					$("#thumbnail").attr("src", e.target.result);
				};
				reader.readAsDataURL(input.files[0]);
			}
		}

		document.addEventListener("DOMContentLoaded", function () {
			var buttonCancel = document.getElementById("buttonCancel");
			if (buttonCancel) {
				buttonCancel.addEventListener("click", function () {
					window.location.href = "/NexKartAdmin/Users";
				});
			}
		});

		function checkEmailUnique(form) {
			var url = "[[@{/users/check_email}]]";
			var userEmail = $("#email").val();
			var csrfvalue = $("input[name='_csrf']").val();
			var userId = $("#id").val();
			var params = {id: userId,mail: userEmail, _csrf: csrfvalue };

			$.post(url, params, function (response) {
				if (response == "OK") {
					form.submit();
				} else if (response == "Duplicated") {
					alert("Email is already registered : " + userEmail);
					
				} else {
					alert("Unexpected response from the server: " + response);
				}
			}).fail(function () {
				alert("An error occurred while processing your request.");
			});

			return false;
		}	
	</script>

</body>

</html>